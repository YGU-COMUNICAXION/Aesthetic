---
// Slider.astro
import { Image } from "astro:assets";
import slide1 from "@assets/img/slider1.jpg";
import slide2 from "@assets/img/slider2.jpg";
import slide3 from "@assets/img/slider3.jpg";

const slides = [slide1, slide2, slide3];
---

<section id="slider" class="relative w-full h-[65vh] overflow-hidden">
  {
    slides.map((slide, i) => (
      <Image
        src={slide}
        alt=""
        class={`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${i === 0 ? "opacity-100" : "opacity-0"}`}
        data-index={i}
      />
    ))
  }

  <!-- Dots -->
  <div
    class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 z-20"
  >
    {
      slides.map((_, i) => (
        <button
          class={`w-3 h-3 border border-white shadow  rounded-full transition-all duration-300 ${i === 0 ? "opacity-100 bg-white" : "opacity-50 bg-white/50"} hover:cursor-pointer`}
          data-dot-index={i}
          aria-label={`Go to slide ${i + 1}`}
        />
      ))
    }
  </div>
</section>

<script>
  document.addEventListener("astro:page-load", () => {
    const slider = document.getElementById("slider");
    if (!slider) return;
    const slidesList = slider.querySelectorAll("[data-index]");
    const dots = slider.querySelectorAll("[data-dot-index]");
    let current = 0;

    const goToSlide = (index: number) => {
      // Hide current
      slidesList[current].classList.replace("opacity-100", "opacity-0");
      dots[current].classList.replace("opacity-100", "opacity-50");
      dots[current].classList.replace("bg-white", "bg-white/50");

      // Show new
      current = index;
      slidesList[current].classList.replace("opacity-0", "opacity-100");
      dots[current].classList.replace("opacity-50", "opacity-100");
      dots[current].classList.replace("bg-white/50", "bg-white");
    };

    // Auto-rotate
    setInterval(() => {
      const next = (current + 1) % slidesList.length;
      goToSlide(next);
    }, 5000);

    // Click dots
    dots.forEach((dot) => {
      dot.addEventListener("click", () => {
        const index = parseInt(dot.getAttribute("data-dot-index") ?? "0");
        goToSlide(index);
      });
    });
  });
</script>
